{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/recruitment_styles.css' %}">
{% endblock %}

{% block content %}
<h1 class="page-title">Recruitment Summary</h1>

    <div class="report-container">
        <div class="report-header">
            <h3>Recruitment Report</h3>
        </div>

        <form method="post" action="{% url 'recruitment-summary' %}">
            {% csrf_token %}
            <div class="filter-section">
                <div class="filter-row">
                    <div class="filter-item">
                        <div class="select-wrapper">
                            <label>Projects</label>
                            <select id="projects" name="projects" class="filter-select">
                                <option value="all" selected>All items checked</option>
                                {% if projects_names %}
                                    {% for project in projects_names %}
                                        <option value={{project.project_id}}>{{ project.project_name }}</option>
                                    {% endfor %}
                                {% else %}
                                {% endif %}
                            </select>
                        </div>
                    </div>
                    <div class="filter-item">
                        <div class="select-wrapper">
                            <label>Arrival From</label>
                            <input class="input_date" type="date" id="arrival_from" name="arrival_from" value="{{ arrival_from|date:'Y-m-d' }}">
                        </div>
                    </div>
                    <div class="filter-item">
                        <div class="select-wrapper">
                            <label>Arrival To</label>
                            <input class="input_date" type="date" id="arrival_to" name="arrival_to" value="{{ arrival_to|date:'Y-m-d' }}">
                        </div>  
                    </div>
                </div>
                <div class="button-row">
                    <button type="submit" class="btn-filter">Filter</button>
                    <button type="submit" formaction="{% url 'export-recruitment-summary' %}" class="btn-export">Export</button>
                </div>
            </div>
        </form>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Project</th>
                        <th>Current Status</th>
                        <th>TotalArrived</th>
                    </tr>
                </thead>
                <tbody>
                    {% if projects_list %}
                        {% for project in projects_list %}
                        <tr>
                            <td>{{ project.project_name }}</td>
                            <td>{{ project.project_status }}</td>
                            <td>{{ project.total_arrived }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <!-- Demo data to match screenshot -->
                        <tr><td>AL ZOUR</td><td>Arrived</td><td>7</td></tr>
                        <tr><td>SERVIORE 2</td><td>Arrived</td><td>22</td></tr>
                        <tr><td>POOL</td><td>Arrived</td><td>30</td></tr>
                        <tr><td>KOTC</td><td>Arrived</td><td>42</td></tr>
                        <tr><td>KPH</td><td>Arrived</td><td>258</td></tr>
                        <tr><td>AL Gharam</td><td>Arrived</td><td>40</td></tr>
                        <tr><td>GFS Security</td><td>Arrived</td><td>9</td></tr>
                        <tr><td>MARAFE</td><td>Arrived</td><td>7</td></tr>
                        <tr><td>GAL</td><td>Arrived</td><td>13</td></tr>
                        <tr><td>LOUIS BERGER</td><td>Arrived</td><td>32</td></tr>
                        <tr><td>JV</td><td>Arrived</td><td>53</td></tr>
                        <tr><td>GSD</td><td>Arrived</td><td>4</td></tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        
        <div class="chart-container">
            <h3>Recruitment Summary</h3>
            {% if use_chart_js %}
                <canvas id="recruitmentChart" height="300"></canvas>
            {% else %}
                <!-- Placeholder for the chart image -->
                <div class="chart-placeholder">
                    <img src="{% static 'images/chart_placeholder.png' %}" alt="Recruitment Chart" class="chart-image">
                </div>
            {% endif %}
        </div>
    </div>

{% if use_chart_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('recruitmentChart').getContext('2d');
    
    // Extract data from Django context or use sample data
    const projectNames = [{% for project in projects_list %}"{{ project.project_name }}",{% endfor %}];
    const totalArrivedData = [{% for project in projects_list %}{{ project.total_arrived }},{% endfor %}];
    
    // If no data is provided by Django, use sample data
    const sampleProjectNames = ['AL ZOUR', 'SERVIORE 2', 'POOL', 'KOTC', 'KPH', 'AL Gharam', 'GFS Security', 'MARAFE', 'GAL', 'LOUIS BERGER', 'JV', 'GSD', 'Other'];
    const sampleArrivedData = [7, 22, 30, 42, 258, 40, 9, 7, 13, 32, 53, 4, 2221, 4244];
    
    const finalProjectNames = projectNames.length > 0 ? projectNames : sampleProjectNames;
    const finalArrivedData = totalArrivedData.length > 0 ? totalArrivedData : sampleArrivedData;

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: finalProjectNames,
            datasets: [{
                label: 'Total arrived',
                data: finalArrivedData,
                backgroundColor: 'rgb(0, 0, 255)',
                borderColor: 'rgb(0, 0, 255)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Total Arrived'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Project Name'
                    }
                }
            }
        }
    });
});
</script>
{% endif %}
{% endblock %}